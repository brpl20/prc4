<div class="col-md-12 col-sm-12">
  <div class="x_panel">

    <div class="x_title clearfix">
      <h1 class="pull-left"><%= @client.name + ' ' + @client.lastname %></h1>

      <ul class="nav navbar-right panel_toolbox">
        <li>
          <span id="status-client" class="btn">
            <%= retrieve_value_from_array(options_for_status_client, @client.status) %>
          </span>
        </li>

        <li>
          <span>
            <%= link_to '', edit_client_path(@client), {class:"btn fa fa-edit btncent btn-link"} %>
          </span>
        </li>

        <li>
          <a class="collapse-link btncent">
            <i class="fa fa-chevron-up"></i>
          </a>
        </li>
      </ul>
    </div>

    <div class="x_content">

      <div class="col-md-12 no-padding">

        <% if @client.capacity != 'Capaz' && !@client.customer_types.any? %>
          <div class="alert alert-danger container-flex" role="alert">
            <p>Este cliente foi definido como incapaz ou parcialmente incapaz e não possui um representante</p>

            <%= link_to 'Informar Representante Legal', edit_client_path(@client), class:'btn btn-outline btn-danger'%>
          </div>
        <% end %>

        <section class="col-md-4">

            <h2 class="pull-left col-md-12 h-line"> <i class="fa fa-user"></i> <b>Informações Pessoais</b></h2>

            <span class="col-md-12">
              <b>Genero:</b>
              <%= gender_name(@client.gender) %>
            </span>

            <span class="col-md-12">
              <b>Nacionalidade:</b>
              <%= @client.citizenship %>
            </span>

            <span class="col-md-12">
              <b>Estado civil:</b>
              <%= @client.civilstatus %>
            </span>

            <span class="col-md-12">
              <b>Nascimento:</b>
              <%= @client.birth %>
            </span>

            <span class="col-md-12">
              <b>RG:</b>
              <%= @client.general_register %>
            </span>

            <span class="col-md-12">
              <b>CPF:</b>
              <%= @client.social_number %>
            </span>

            <span class="col-md-12">
              <strong>Mae:</strong>
              <%= @client.mothername %>
            </span>

            <span class="col-md-12">
              <strong>NIT:</strong>
              <%= @client.nit %>
            </span>

            <span class="col-md-12">
              <strong>Capacidade:</strong>
              <%= @client.capacity %>
            </span>

        </section>

        <section class="col-md-4">

            <h2 class="pull-left h-line"> <i class="fa fa-home"></i> <b>Enderço</b></h2>

            <span class="col-md-12">
              <b>Endereco:</b>
              <%= @client.address %>
            </span>

              <span class="col-md-12">
                <b>Cidade:</b>
                <%= @client.city %>
              </span>

              <span class="col-md-12">
                <b>Estado:</b>
                <%= @client.state %>
              </span>

              <span class="col-md-12">
                <b>CEP:</b>
                <%= @client.zip %>
              </span>

        </section>

        <section class="col-md-4">
          <h2 class="pull-left h-line"> <i class="fa fa-file"></i> <b>Documentos</b></h2>

          <div class="col-md-12">
            <% if @client.documents.nil? %>
              <i class="fa fa-times"></i>
              <p class="in-line">Não há documentos para download</p>
            <% else %>
              <%= link_to @client.documents["aws_link"], class: "btn btn-info col-md-6" do %>
                <i class="fa fa-download"></i> Procuração Simples
              <% end %>
            <% end %>
          </div>

        </section>

      </div>

      <div class="col-md-12">

        <section class="col-md-4">

          <h2 class="pull-left h-line"> <i class="fa fa-phone"></i> <b>Contato</b></h2>

          <% @client.phones.each do |ph| %>
            <span class="col-md-12">
              <b>Telefone:</b>
              <%= ph.phone %>
            </span>
          <% end %>

          <% @client.emails.each do |em| %>
            <span class="col-md-12">
              <b>E-mail: </b>
              <%= em.email %>
            </span>
          <% end %>

        </section>

        <section class="col-md-4">
          <h2 class="pull-left h-line cem_percent">
            <i class="fa fa-university"></i>
            <b>Informações Bancárias</b>
          </h2>

          <% if @client.bank %>
            <span class="col-md-12">
              <b>Banco:</b>
              <%= @client.bank&.name %>
            </span>

            <span class="col-md-12">
              <b>Agência:</b>
              <%= @client.bank&.agency %>
            </span>

            <span class="col-md-12">
              <b>Conta:</b>
              <%= @client.bank&.account %>
            </span>
          <% else %>
            <i class="fa fa-times"></i>
            <p class="in-line">Não há conta cadastrada</p>
          <% end %>

        </section>

        <section class="col-md-4">
          <h2 class="pull-left h-line">
            <i class="fa fa-asterisk"></i>
            <b>Representante</b>
          </h2>

          <span class="col-md-12">
            <% unless @client.customer_types.nil? %>

              <% @client.customer_types.each do |ct| %>
                  <p>
                    <%= retrieve_represented(ct.represented) %> -
                    <%= ct.description %>
                  </p>
              <% end %>

            <% else %>
              <i class="fa fa-times"></i>
              <p class="in-line">Não há representante/contador</p>
            <% end %>

          <span class="col-md-12">
            <strong></strong>

          </span>

        </section>

        <section class="col-md-4">
          <h2 class="pull-left h-line">
            <i class="fa fa-asterisk"></i>
            <b>Informações Adicionais</b>
          </h2>

          <span class="col-md-12">
            <strong>Profissao:</strong>
            <%= @client.profession %>
          </span>

          <span class="col-md-12">
            <strong>Empresa atual:</strong>
            <%= @client.company %>
          </span>

          <span class="col-md-12">
            <strong>Número do Benefício:</strong>
            <%= @client.number_benefit %>
          </span>

        </section>

        <section class="col-md-4">
          <h2 class="pull-left h-line cem_percent">
            <i class="fa fa-file"></i>
            <b>Arquivos</b>
          </h2>

          <% if @client.files.empty? %>
            <i class="fa fa-times"></i>
            <p class="in-line">Não há arquivos.</p>
          <% end %>

          <% @client.files.each do |file| %>
            <span class="col-md-12">
              <li>
                <%= link_to file.filename, url_for(file), target:'_blank' %>
                <%= link_to ("X"), client_file_upload_path(@client, file), method: :delete, data: { confirm: "Tem certeza?" }, class:"adj100 btn btn-outline btn-danger btn-remove" %>
              </li>
            </span>
          <% end %>

        </section>

      </div>
    </div>
  </div>

  <div class="x_panel">

    <div class="x_title clearfix">
      <h1 class="pull-left">Trabalhos Pendentes</h1>
    </div>

    <div class="x_content">

      <div class="col-md-12">

        <table class="table table-striped">
          <thead>
            <tr>
              <th>#</th>
              <th>Procedimento</th>
              <th>Assunto</th>
              <th>Ação</th>
            </tr>
          </thead>
          <tbody>
            <% @client.works.each do |work| %>
              <td><%= work.id %></td>
              <td>
                <% work.procedures.each do |p| %>
                  <%= p.description %>
                <% end %>
              </td>
              <td><%= work.subject %></td>
              <td><%= work.action %></td>
            <% end %>
          </tbody>
        </table>

      </div>
    </div>
  </div>

  <div class="x_panel">

    <div class="x_title clearfix">
      <h1 class="pull-left">Tarefas Pendentes</h1>
    </div>

    <div class="x_content">

      <% if jobs_to_this_client?(@client) %>
        <div>

          <table class="table table-striped">
            <thead>
              <tr>
                <th>#</th>
                <th>Tarefa</th>
                <th>Trabalho</th>
                <th>Deadline</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <% @jobs.each do |job| %>
                <tr>
                  <td scope="row"><%= job.id %></td>

                  <td>
                    <%= link_to job_path(job) do %>
                      <%= job.description %>
                    <% end %>
                  </td>

                  <td scope="row"><%= job.work_id %></td>

                  <td> <%= job.deadline %></td>

                  <td><%= retrieve_value_from_array(options_for_job_status, job.status.to_i) %>
                   </td>

                </tr>
              <% end %>
            </tbody>
          </table>

        </div>

      <% else %>

        <p>Não foram encontradas tarefas para este cliente.</p>

      <% end %>

    </div>
  </div>

  <%= link_to "Voltar", clients_path, class:"btn btn-danger btn-outline left col-md-1" %>
</div>
<%= render partial: "shared/modal" %>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js" defer></script>
